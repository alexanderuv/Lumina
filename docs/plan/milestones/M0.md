# Lumina — Milestone 0 Functional Specification
**Milestone Code:** M0  
**Scope:** Wave A (Core Windowing & Input) — macOS + Windows  
**Document Type:** Functional Specification  
**Version:** 1.0  
**Status:** Draft  
**Author:** ChatGPT (GPT-5)  
**Date:** 2025-10-04  

---

## 1  Objective

Deliver a cross-platform foundation for desktop windowing on **macOS** and **Windows** with feature parity for **Wave A** as defined in the master plan.  
This milestone provides the minimal set of primitives required for any desktop Swift app to create a window, process events, and handle basic user input.

---

## 2  In-Scope Features

### 2.1  Application & Event Loop
| Feature | Description |
|----------|--------------|
| Event Loop Modes | Support `run`, `poll`, and `wait` modes with low-power sleep. |
| User Events | Allow apps to post custom events into the queue. |
| Termination | Graceful shutdown via system quit or explicit app exit. |
| Threading Model | Single-threaded UI loop enforced; background threads not allowed to call UI APIs. |

### 2.2  Window Fundamentals
| Feature | Description |
|----------|--------------|
| Window Lifecycle | Create / show / close operations. |
| Attributes | Title, resizable, min / max size, visibility toggle, focus. |
| Move & Resize | Window can be repositioned or resized programmatically. |

### 2.3  DPI / Scaling
| Feature | Description |
|----------|--------------|
| Logical vs Physical Size | Distinguish between device-independent and pixel sizes. |
| Scale Factor Change Events | Notify app when display scale changes (e.g. moving between monitors). |

### 2.4  Pointer & Wheel Input
| Feature | Description |
|----------|--------------|
| Pointer Movement | Deliver motion events with position in logical coordinates. |
| Enter / Leave Events | Window receives focus in/out for pointer. |
| Buttons | Left / Right / Middle press and release events. |
| Wheel Input | Vertical and horizontal scroll events with delta precision. |

### 2.5  Keyboard Input (Basic)
| Feature | Description |
|----------|--------------|
| Key Events | Key down / up with keycodes and modifiers. |
| Text Input | UTF-8 text events for Latin layouts. |
| Modifier State | Expose Shift / Ctrl / Alt / Cmd state. |

### 2.6  System Cursors
| Feature | Description |
|----------|--------------|
| Cursor Set | Default system cursors (arrow, ibeam, crosshair, resize, hand). |
| Visibility | Show / hide cursor programmatically. |

### 2.7  Examples & Docs
- `Hello Window` — Create and show a basic window.  
- `Input Explorer` — Display pointer and keyboard events.  
- `Scaling Demo` — Show logical vs physical sizes and scale factor changes.  

---

## 3  Out of Scope (for M0)

| Category | Deferred to Wave |
|-----------|----------------|
| Window decorations / styles | Wave B |
| Clipboard text | Wave B |
| Monitor enumeration | Wave B |
| IME composition | Wave C |
| Fullscreen / theming | Wave D |
| Drag & Drop / Rich clipboard | Wave E |

---

## 4  Non-Functional Requirements

| Area | Requirement |
|------|--------------|
| **Language API** | Swift-native, Sendable where applicable, no Objective-C bridges. |
| **Thread Safety** | Event loop confined to main thread; background tasks communicate via user events. |
| **Determinism** | Identical event ordering and timing semantics across platforms. |
| **Performance** | Event dispatch latency < 2 ms on average. |
| **Error Handling** | Failures return explicit `Result` types or throw typed errors. |
| **Docs** | Public API reference and tutorial examples included. |

---

## 5  Testing & Validation

| Test Type | Coverage |
|------------|-----------|
| Unit Tests | Event loop state transitions, window attribute changes, input event translation. |
| Integration Tests | Golden event traces for each example app. |
| Automation | CI pipelines for macOS and Windows (virtual display + input synthesis). |
| Manual QA | DPI change tests on multi-monitor macOS / Windows setups. |
| Stability | 24-hour idle loop test without memory leak or CPU spike. |

---

## 6  Deliverables

1. **Lumina Core Library** — `LuminaCore` module with unified API.  
2. **Platform Backends** — `LuminaPlatformMac` and `LuminaPlatformWin`.  
3. **Examples** — `HelloWindow`, `InputExplorer`, `ScalingDemo`.  
4. **Developer Documentation** — README + API reference + usage guide.  
5. **Continuous Integration** — Automated build and event trace verification.  

---

## 7  Definition of Done (DoD)

| Area | Acceptance Criteria |
|------|---------------------|
| **Functionality** | All features listed in § 2 implemented and documented. |
| **Cross-Platform Parity** | All example apps run identically on macOS and Windows. |
| **API Stability** | No breaking changes introduced without RFC after internal review. |
| **Testing** | ≥ 95 % unit coverage for core event loop and window APIs. |
| **Performance** | Average event dispatch < 2 ms (measured under CI load). |
| **Memory Safety** | No leaks or dangling pointers under continuous run. |
| **CI Passing** | Automated pipeline green for macOS and Windows. |
| **Documentation** | Public API and examples verified for build success and accuracy. |
| **Version Tag** | Repository tagged `v0.1.0-alpha` upon completion. |

---

## 8  Acceptance Procedure

1. Run example apps on macOS and Windows.  
2. Verify functional parity and event trace diff matches reference.  
3. Run CI pipeline (success required).  
4. Approve release tag and publish prebuilt binaries for both platforms.  

---

## 9  Risks & Mitigations (Specific to M0)

| Risk | Mitigation |
|------|-------------|
| macOS AppKit runloop integration | Use CFRunLoop bridge for low-power wait modes. |
| Windows message pump timing differences | Normalize timestamps to monotonic clock. |
| DPI scaling mismatch between OSes | Introduce explicit `LogicalSize` and `PhysicalSize` types. |

---

✅ **Milestone 0 Completion = “Lumina Wave A (Core) parity achieved on macOS and Windows.”**
